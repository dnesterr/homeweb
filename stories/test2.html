<html>
    <head>
        <script lang="text/javascript" src="library2.js"></script>
        <script lang="text/javascript" src="util.js"></script>
    </head>
    <body>
        <table border="1">
            <tbody id="fillme">
            </tbody>
        </table>
        <script>
            <!--
var defaultConfig = {
    showAllColumns: false,
    filters: {
        State: "Downloaded",
    }
};
function createTable(config){
    document.getElementById("fillme").innerHTML =
        createHeaders(config) + createRows(config);
}
createTable(defaultConfig);
function createHeaders(config){
    var html = "<tr>";
    if (config.showAllColumns) {
        var count = 0;
        for (var key in library[0]){
            html += makeTitle(key, count);
            count += 1;
        }
    } else {
        html += makeTitle("Title", 0);
        html += makeTitle("Author", 1);
        html += makeTitle("Series", 2);
        html += makeTitle("#", 3);
    }
    html += "</tr>"
    return html;
}
function makeTitle(name, index){
    return "<th><a href='#' onclick='sortTable("+index+")'/>"+name+"</a></th>";
}
function createRows(config){
    var html = "";
    library.forEach( function(row){
        var print = true;
        for (var key in config.filters){
            if (row[key] != config.filters[key]){
                console.log(key + ": " + row[key] + " != " + config.filters[key]);
                print = false;
                break;
            }
        }
        if (print){
            html += createRow(row, config);
        }
    });
    return html;
}
function createRow(row, config){
    var html = "<tr>";
    if (config.showAllColumns){
        for (var key in row) {
            html += makeCell(row, key, config); 
        }
    } else {
        html += makeCell(row, "Series", config);
        html += makeCell(row, "Author", config);
        html += makeCell(row, "Title", config); 
        html += makeCell(row, "Book Number", config);
        html += makeCell(row, "Folder", config); 
    }
    html += "</tr>"
    return html;
}
function makeCell(row, key, config){
    if (key == "Title"){ 
        return makeTitleLink(row, key, config); }
    else {
        return '<td><a href="#" onclick=\'filter("{0}", "{1}")\'>{1}</a></td>'.format(key, row[key]);
    }
}

function makeTitleLink(row, key, config){
    return '<td><a href="play.php?Folder=B:/Audio/Books/{0}">{1}</a></td>'.format(row["Folder"], row[key]);
}

function filter(key, value){
    var clone = Object.assign({}, defaultConfig);
    clone.filters[key] = value;
    createTable(clone);
}

-->
    </script>


    <script>
        function sortTable(columnToSort) {
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById("fillme");
            switching = true;
            // loop until no switching has been done
            while (switching) {
                //start by saying: no switching is done:
                switching = false;
                rows = table.rows;
                /*Loop through all table rows (except the
    first, which contains table headers):*/
                for (i = 1; i < (rows.length - 1); i++) {
                    //start by saying there should be no switching:
                    shouldSwitch = false;
                    /*Get the two elements you want to compare,
      one from current row and one from the next:*/
                    x = rows[i].getElementsByTagName("TD")[columnToSort];
                    y = rows[i + 1].getElementsByTagName("TD")[columnToSort];
                    //check if the two rows should switch place:
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                }
                if (shouldSwitch) {
                    /*If a switch has been marked, make the switch
      and mark that a switch has been done:*/
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }
        }
-->
    </script>
    </body>
</html>
